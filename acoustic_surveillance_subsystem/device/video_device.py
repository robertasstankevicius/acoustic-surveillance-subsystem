import vlc

from acoustic_surveillance_subsystem.secrets import full_address
from acoustic_surveillance_subsystem.utils import send_packet_and_close


class VideoDevice:
    MOST_LEFT_ANGLE = 8
    MOST_RIGHT_ANGLE = 354

    TOP_MOST_ANGLE = 90
    BOTTOM_MOST_ANGLE = -23

    def __init__(self):
        self.horizontal_angle = 179  # pretty sure this is right, or it can be 178
        self.vertical_angle = 0

        player = vlc.MediaPlayer(full_address)
        player.play()

    def turn_right(self, angle: int):
        packet_start = b'\xcc\xdd\xee\xff\x77\x4f\x00\x00\xe3\x12\x69\x00\x48\x00\x00\x00\x00\x00\x00\x00\xaf\x93\xc6\x3b\x09\xf7\x4b\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
        # TODO: angle int to hex bytes
        angle = bytes([angle])
        packet_end = b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'

        packet = packet_start + angle + packet_end

        send_packet_and_close('192.168.0.118', 23456, packet)

    def turn_left(self, angle: int):
        packet_start = b'\xcc\xdd\xee\xff\x77\x4f\x00\x00\xe3\x12\x69\x00\x48\x00\x00\x00\x00\x00\x00\x00\xaf\x93\xc6\x3b\x09\xf7\x4b\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
        # TODO: angle int to hex bytes
        angle = bytes([255 - angle])
        packet_end = b'\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'

        packet = packet_start + angle + packet_end

        send_packet_and_close('192.168.0.118', 23456, packet)

    def turn_up(self, angle: int):
        packet_start = b'\xcc\xdd\xee\xff\x77\x4f\x00\x00\xe3\x12\x69\x00\x48\x00\x00\x00\x00\x00\x00\x00\xaf\x93\xc6\x3b\x09\xf7\x4b\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
        # TODO: angle int to hex bytes
        angle = bytes([angle])
        packet_end = b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'

        packet = packet_start + angle + packet_end

        send_packet_and_close('192.168.0.118', 23456, packet)

    def turn_down(self, angle: int):
        packet_start = b'\xcc\xdd\xee\xff\x77\x4f\x00\x00\xe3\x12\x69\x00\x48\x00\x00\x00\x00\x00\x00\x00\xaf\x93\xc6\x3b\x09\xf7\x4b\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
        # TODO: angle int to hex bytes
        angle = bytes([255 - angle])
        packet_end = b'\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'

        packet = packet_start + angle + packet_end

        send_packet_and_close('192.168.0.118', 23456, packet)
